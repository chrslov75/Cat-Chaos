<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Cat Chaos Defender</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
  body,html{margin:0;height:100%;overflow:hidden;background:#ffe4e1;font-family:system-ui}
  canvas{display:block;width:100%;height:100%;background:#f5f5dc}
  #msg{position:fixed;top:10px;left:50%;transform:translateX(-50%);color:#333;font:bold 18px system-ui;text-align:center;z-index:10;pointer-events:none;background:rgba(255,255,255,0.7);padding:8px 16px;border-radius:12px}
</style>
</head>
<body>
<div id="msg">Tap cats to scare them!<br>Kermit throws glasses!</div>
<canvas id="cv"></canvas>
<script>
const canvas=document.getElementById('cv'),ctx=canvas.getContext('2d');
let w=canvas.width=window.innerWidth,h=canvas.height=window.innerHeight;
window.addEventListener('resize',()=>{w=canvas.width=innerWidth;h=canvas.height=innerHeight});

let score=0,high=localStorage.hs||0,lives=5,gameOver=false;
let items=[],cats=[],glasses=[];

// Real emojis
const catEmoji = {oscar:'Cat1',nibbles:'Cat2',dusty:'Cat3',chester:'Cat4',kermit:'Cat5'};
const itemEmoji = {g:'Glass',l:'Lamp'};

function initItems(){items=[];lives=5;for(let i=0;i<5;i++)items.push({x:w*0.7+40+i*60,y:h*0.65-50,type:Math.random()>0.5?'g':'l'})}
function spawnCat(){
  const type=['oscar','nibbles','dusty','chester','kermit'][Math.floor(Math.random()*5)];
  const kermit=type==='kermit';
  const vx=(1.8+Math.random()*0.8+(kermit?1.8:0))*(w/800);
  const y=[h*0.38,h*0.48,h*0.58,h*0.68][Math.floor(Math.random()*4)];
  cats.push({x:-120,y,vx,type,scared:false,throwTimer:kermit?Math.random()*60:0});
}
function sound(f=800,t='sine'){const a=new AudioContext(),o=a.createOscillator(),g=a.createGain();o.type=t;o.frequency.value=f;g.gain.setValueAtTime(0.4,a.currentTime);g.gain.exponentialRampToValueAtTime(0.01,a.currentTime+0.25);o.connect(g);g.connect(a.destination);o.start();o.stop(a.currentTime+0.25)}
function loseLife(){if(lives-->0&&items.length)items.splice(Math.floor(Math.random()*items.length),1);sound(100,'sawtooth');if(lives<=0){gameOver=true;high=Math.max(score,high);localStorage.hs=high}}

canvas.addEventListener('touchstart',e=>e.preventDefault()||tap(e),{passive:false});
canvas.addEventListener('click',tap);
function tap(e){
  if(gameOver){score=0;lives=5;items=[];cats=[];glasses=[];gameOver=false;initItems();spawnCat();return}
  const x=e.touches?e.touches[0].clientX:e.clientX